var AWS_COMMON=function(){var user,aStart,serv="apex",domain="com.com",port="",params="",doCallback=true,maxTime=750,callTime=0,callStatus=1;function setStartCall(){aStart=(new Date()).getTime()}function setStatus(){if(callStatus===1){doCallback=false;callStatus=-1}}function jsAppend(script_src){var html_doc=document.getElementsByTagName("head")[0],js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("async","true");js.setAttribute("src",script_src);html_doc.insertBefore(js,html_doc.firstChild)}function setParams(cbsiGlobal,callback){var referrer=document.referrer;params="refUrl="+escape(referrer)+"&sId="+cbsiGlobal.SITE+"&ptId="+((cbsiGlobal.PTYPE)?cbsiGlobal.PTYPE:"0")+"&onId="+((cbsiGlobal.NODE)?cbsiGlobal.NODE:"0")+"&asId="+((cbsiGlobal.PID)?cbsiGlobal.PID:"0")+"&edId="+((cbsiGlobal.EDITION_ID)?cbsiGlobal.EDITION_ID:"0")+"&t="+(new Date()).getTime()+((callback)?"&callback="+callback:"")}function startsWith(checkString,pattern){return(checkString.match("^"+pattern)==pattern)}function getData(timeout,serverPath){setStartCall();maxTime=((timeout)?timeout:maxTime);callTime=maxTime;jsAppend("http://"+serv+"."+domain+port+serverPath+params);setTimeout(function(){setStatus()},maxTime)}this.loadArrowData=function(cbsiGlobal,timeout){setParams(cbsiGlobal,"parseArrowResponse");getData(timeout,"/aws/rest/v1.0/arrowUser?")};this.getUser=function(){return user};this.getCallTime=function(){return callTime};this.parseArrowResponse=function(arrowResponse){if(doCallback){callTime=((new Date()).getTime()-aStart);user=eval(arrowResponse);if(user&&!user.Error){var len=user.userBuckets.length;var aIds="";for(var i=0;i<len;++i){var segId=user.userBuckets[i];if(startsWith(segId,"mad-")){if(aIds!==""){aIds+=","}aIds+=segId.substr(4)}}if(typeof cbsiSetUserGroup==="function"){cbsiSetUserGroup(aIds)}}callStatus=0}};this.loadOfferData=function(cbsiGlobal,timeout){setParams(cbsiGlobal,null);getData(timeout,"/aws/rest/v1.0/offerScript?");callTime=((new Date()).getTime()-aStart)};this.showOfferData=function(cbsiGlobal,offerIds,clgfId,regId,timeout){params="offerId="+offerIds+"&sId="+cbsiGlobal.SITE+"&ptId="+((cbsiGlobal.PTYPE)?cbsiGlobal.PTYPE:"0")+"&onId="+((cbsiGlobal.NODE)?cbsiGlobal.NODE:"0")+"&asId="+((cbsiGlobal.PID)?cbsiGlobal.PID:"0")+"&edId="+((cbsiGlobal.EDITION_ID)?cbsiGlobal.EDITION_ID:"0")+"&t="+(new Date()).getTime()+((clgfId)?"&anonId="+clgfId:"")+((regId)?"&regId="+regId:"");getData(timeout,"/aws/offer/offerScript?");callTime=((new Date()).getTime()-aStart)}};if(!window.cbsiApex){var cbsiApex=new AWS_COMMON();var parseArrowResponse=cbsiApex.parseArrowResponse;var cbsiGetApexUser=cbsiApex.getUser;var cbsiLoadApexData=cbsiApex.loadArrowData;var cbsiLoadOffer=cbsiApex.loadOfferData;var cbsiShowOffer=cbsiApex.showOfferData;var cbsiApexCallTime=cbsiApex.getCallTime};